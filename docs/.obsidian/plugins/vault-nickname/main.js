/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => VaultNicknamePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_PLUGIN_SETTINGS = {
  overrideAppTitle: "override-app-title:file-first"
};
var DEFAULT_SHARED_SETTINGS = {
  nickname: "My Vault Nickname"
};
var PATH_SEPARATOR = import_obsidian.Platform.isWin ? "\\" : "/";
var VAULT_LOCAL_SHARED_SETTINGS_FILE_PATH = ".vault-nickname";
var VaultNicknamePlugin = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    /// Is the plugin is enabled. Used by `onload` to reliably check the
    /// plugin's state as a workaround for `this.app.plugins.enabledPlugins`
    /// omitting plugins that are actively loading.
    ///
    this.isEnabled = false;
  }
  async onload() {
    this.isEnabled = true;
    this.vaultItemRenamedCallback = this.onVaultItemRenamed.bind(this);
    this.activeLeafChangeCallback = this.onActiveLeafChange.bind(this);
    await this.loadSettings();
    const settingsFilePath = this.getSharedSettingsFilePath();
    let saveSettingsExist = false;
    await this.app.vault.adapter.exists(settingsFilePath).then(
      (exists) => {
        saveSettingsExist = exists;
      },
      (rejectReason) => {
        saveSettingsExist = false;
      }
    );
    if (!saveSettingsExist) {
      await this.saveSettings();
    }
    this.addSettingTab(new VaultNicknameSettingTab(this.app, this));
    this.app.workspace.onLayoutReady(this.onLayoutReady.bind(this));
    this.registerEvent(this.app.vault.on("rename", this.vaultItemRenamedCallback));
    this.registerEvent(this.app.workspace.on("active-leaf-change", this.activeLeafChangeCallback));
  }
  onunload() {
    this.isEnabled = false;
    this.useVaultSwitcherCallbacks(false);
    this.refreshVaultDisplayName();
    if (this.desktopVaultSwitcherElement) {
      this.desktopVaultSwitcherElement.remove();
      this.desktopVaultSwitcherElement = null;
    }
  }
  /// Creates an invisible 'interceptor' element over the vault switcher
  /// element. This is used to catch click events and recreate Obsidian's
  /// normal menus, but displaying the vault nicknames. This was necessary
  /// to make the plugin work on macOS where these context menus are rendered
  /// natively and otherwise couldn't be modified.
  ///
  onLayoutReady() {
    const originalDesktopVaultSwitcherElement = window.activeDocument.querySelector(".workspace-drawer-vault-switcher");
    if (!originalDesktopVaultSwitcherElement) {
      console.error("Vault switcher element not found. Cannot create element to intercept its events.");
    } else {
      originalDesktopVaultSwitcherElement.style.position = "relative";
      this.desktopVaultSwitcherElement = originalDesktopVaultSwitcherElement.createDiv(".workspace-drawer-vault-switcher-vault-nickname-interceptor");
      Object.assign(
        this.desktopVaultSwitcherElement.style,
        {
          position: "absolute",
          top: "0",
          left: "0",
          width: "100%",
          height: "100%",
          backgroundColor: "transparent",
          display: "none"
        }
      );
      this.desktopVaultSwitcherElement.addEventListener("click", this.onVaultSwitcherClicked.bind(this));
      this.desktopVaultSwitcherElement.addEventListener("contextmenu", this.onVaultSwitcherContextMenu.bind(this));
      this.useVaultSwitcherCallbacks(true);
    }
    this.refreshVaultDisplayName();
  }
  useVaultSwitcherCallbacks(use) {
    if (import_obsidian.Platform.isMobile) {
      return;
    }
    if (this.desktopVaultSwitcherElement) {
      this.desktopVaultSwitcherElement.style.display = use ? "block" : "hidden";
    }
  }
  /// Query for a selector. If not found, try observing for
  /// `timeoutMilliseconds` for it to be added, otherwise return `null`.
  ///
  async waitForSelector(searchFrom, selector, timeoutMilliseconds) {
    return new Promise((resolve) => {
      const element = searchFrom.querySelector(selector);
      if (element) {
        return resolve(element);
      }
      const timeout = setTimeout(() => resolve(null), timeoutMilliseconds);
      const observer = new MutationObserver((mutations) => {
        const element2 = searchFrom.querySelector(selector);
        if (element2) {
          clearTimeout(timeout);
          observer.disconnect();
          resolve(element2);
        }
      });
      observer.observe(searchFrom, {
        childList: true,
        subtree: true
      });
    });
  }
  /// Invoked when a vault item is renamed. Applies the vault's nickname to
  /// the window title.
  ///
  onVaultItemRenamed(_) {
    this.refreshVaultDisplayName();
  }
  /// Invoked when the active workspace leaf was changed. Applies the vault's
  /// nickname to the window title.
  ///
  onActiveLeafChange(_) {
    this.refreshVaultDisplayName();
  }
  /// Invoked when the user clicks the workspace's vault switcher drawer.
  /// This function changes the vault names shown in the vault popup menu
  /// to the names provided by the vault's personal Vault Nickname plugin.
  ///
  onVaultSwitcherClicked(event2) {
    if (event2.shiftKey) {
      return;
    }
    event2.stopPropagation();
    const vaults = electron.ipcRenderer.sendSync("vault-list");
    const menu = new import_obsidian.Menu();
    for (let vaultKey in vaults) {
      const vault = vaults[vaultKey];
      const vaultPath = (0, import_obsidian.normalizePath)(vault.path);
      let vaultName = vaultPath.substring(vaultPath.lastIndexOf("/") + 1);
      const vaultPluginSettingsFilePath = (0, import_obsidian.normalizePath)([
        vault.path,
        VAULT_LOCAL_SHARED_SETTINGS_FILE_PATH
      ].join(PATH_SEPARATOR));
      if (this.filePathExistsSync(vaultPluginSettingsFilePath)) {
        const vaultPluginSettingsJson = this.readUtf8FileSync(vaultPluginSettingsFilePath);
        if (vaultPluginSettingsJson) {
          const vaultPluginSettings = JSON.parse(vaultPluginSettingsJson);
          if (vaultPluginSettings && vaultPluginSettings.nickname && vaultPluginSettings.nickname.trim()) {
            vaultName = vaultPluginSettings.nickname.trim();
          }
        }
      }
      menu.addItem(
        (item) => item.setTitle(vaultName).setChecked(vault.path === this.app.vault.adapter.basePath).onClick(
          () => window.open(`obsidian://open?vault=${vaultKey}`)
        )
      );
    }
    menu.addSeparator();
    menu.addItem(
      (item) => item.setTitle(window.OBSIDIAN_DEFAULT_I18N.interface.manageVaults).setIcon("open-vault").onClick(
        () => this.app.commands.executeCommandById("app:open-vault")
      )
    );
    menu.showAtMouseEvent(event2);
  }
  /// Invoked when the user context-clicks on the vault switcher drop down.
  /// Adds a "Set nickname" item to the spawned menu as a shortcut to the
  /// plugin's settings page.
  ///
  async onVaultSwitcherContextMenu() {
    if (import_obsidian.Platform.isMobile) {
      return;
    }
    if (event.shiftKey) {
      return;
    }
    event.stopPropagation();
    const menu = new import_obsidian.Menu();
    const showInFolderText = import_obsidian.Platform.isMacOS ? window.OBSIDIAN_DEFAULT_I18N.plugins.openWithDefaultApp.actionShowInFolderMac : window.OBSIDIAN_DEFAULT_I18N.plugins.openWithDefaultApp.actionShowInFolder;
    menu.addItem(
      (item) => item.setTitle(`${showInFolderText}...`).setIcon("lucide-arrow-up-right").onClick(
        () => this.app.showInFolder("")
      )
    );
    menu.addSeparator();
    menu.addItem(
      (item) => item.setTitle("Vault Nickname settings").setIcon("settings").onClick(() => this.openVaultNicknameSettings())
    );
    menu.showAtMouseEvent(event);
  }
  /// Invoked by the custom "Set nickname" menu item added to the vault
  /// switcher's context menu. Opens the plugins setting page for quick
  /// access to nickname field.
  ///
  async openVaultNicknameSettings() {
    this.app.commands.executeCommandById("app:open-settings");
    const settingsMenu = await this.waitForSelector(window.activeDocument, ".mod-settings", 200);
    if (!settingsMenu) {
      console.error("The vault settings menu was not found after the timeout.");
      return;
    }
    const anyTab = await this.waitForSelector(window.activeDocument, ".vertical-tab-nav-item", 200);
    if (!anyTab) {
      console.error("Timeout while waiting for a settings menu tab to be found.");
      return;
    }
    const settingsTabs = settingsMenu.querySelectorAll(".vertical-tab-nav-item");
    for (const tab of settingsTabs) {
      if (tab.textContent !== this.manifest.name) {
        continue;
      }
      tab.click();
      return;
    }
    console.error("Plugin tab not found.");
  }
  /// Refresh the text for the active vault in the workspace's vault switcher
  /// drawer. If no nickname exists for the active vault, the label will
  /// fallback to the vault's folder name.
  ///
  refreshVaultDisplayName() {
    const currentVaultName = this.isEnabled && this.sharedSettings && this.sharedSettings.nickname && this.sharedSettings.nickname.trim() ? this.sharedSettings.nickname.trim() : this.app.vault.getName();
    this.setVaultDisplayName(currentVaultName);
  }
  /// Change the display name of the active vault in the workspace's vault
  /// switcher drawer and the app window's title.
  ///
  async setVaultDisplayName(vaultDisplayName) {
    const selectedVaultNameElement = await this.getVaultTitleElement();
    if (!selectedVaultNameElement) {
      console.error("Vault name element not found. Cannot apply nickname.");
      return;
    }
    if (selectedVaultNameElement) {
      selectedVaultNameElement.textContent = vaultDisplayName;
    }
    this.setAppTitle(vaultDisplayName);
  }
  /// Change the app's title. This applies the provided vault name and
  /// optionally switches the order of the vault and document names.
  ///
  setAppTitle(vaultDisplayName) {
    if (import_obsidian.Platform.isMobileApp) {
      return;
    }
    if (this.settings.overrideAppTitle === "override-app-title:off") {
      this.app.workspace.updateTitle();
      return;
    }
    const titleSeparator = " - ";
    const appTitle = this.app.title;
    if (!appTitle) {
      console.error("no this.app.title");
      return;
    }
    const titleParts = appTitle.split(titleSeparator);
    if (!titleParts || titleParts.length < 2) {
      console.error("unexpected title format: " + appTitle);
      return;
    }
    const obsidianVersion = titleParts[titleParts.length - 1];
    const documentTitle = (() => {
      const activeEditor = this.app.workspace.activeEditor;
      if (activeEditor && activeEditor.titleEl) {
        return activeEditor.titleEl.textContent;
      }
      return "New tab";
    })();
    if (this.settings.overrideAppTitle === "override-app-title:vault-first") {
      window.activeDocument.title = [
        vaultDisplayName,
        documentTitle,
        obsidianVersion
      ].join(titleSeparator);
    } else {
      window.activeDocument.title = [
        documentTitle,
        vaultDisplayName,
        obsidianVersion
      ].join(titleSeparator);
    }
  }
  /// Load the vault's nickname. Currently, a hidden file in the root of the
  /// vault is used because it simplifies sharing vault nicknames between
  /// other instances of the plugin.
  ///
  async loadSettings() {
    const loadedSharedSettings = Object.assign({}, DEFAULT_SHARED_SETTINGS);
    const parentFolderName = this.getVaultParentFolderName();
    if (parentFolderName) {
      loadedSharedSettings.nickname = parentFolderName;
    }
    const sharedSettingsFilePath = this.getSharedSettingsFilePath();
    if (this.filePathExistsSync(sharedSettingsFilePath)) {
      const settingsJson = this.readUtf8FileSync(sharedSettingsFilePath);
      loadedSharedSettings;
      Object.assign(loadedSharedSettings, JSON.parse(settingsJson));
    }
    this.sharedSettings = loadedSharedSettings;
    this.settings = Object.assign({}, DEFAULT_PLUGIN_SETTINGS, await this.loadData());
    this.refreshVaultDisplayName();
  }
  /// Write the vault's nickname to disk. Currently, a hidden file in the
  /// root of the vault is used because it simplifies sharing vault nicknames
  /// between other instances of the plugin.
  ///
  async saveSettings() {
    const sharedSettingsFilePath = this.getSharedSettingsFilePath();
    if (sharedSettingsFilePath) {
      const sharedSettingsJson = JSON.stringify(this.sharedSettings, null, 2);
      this.writeUtf8FileSync(sharedSettingsFilePath, sharedSettingsJson);
    }
    await this.saveData(this.settings);
    this.refreshVaultDisplayName();
  }
  async getVaultTitleElement() {
    return await this.waitForSelector(
      window.activeDocument,
      import_obsidian.Platform.isDesktop ? ".workspace-drawer-vault-name" : ".workspace-drawer-header-name-text",
      200
    );
  }
  /// Get the name of the vault's parent folder. This is used as the plugin's
  /// default vault nickname
  ///
  getVaultParentFolderName() {
    const vaultAbsoluteFilePath = this.app.vault.adapter.getBasePath();
    if (!vaultAbsoluteFilePath) {
      return "";
    }
    const explodedVaultPath = vaultAbsoluteFilePath.split(PATH_SEPARATOR);
    const indexOfParentFolder = explodedVaultPath.length - 2;
    if (indexOfParentFolder < 0 || !explodedVaultPath[indexOfParentFolder] || !explodedVaultPath[indexOfParentFolder].trim()) {
      return "";
    }
    return explodedVaultPath[indexOfParentFolder].trim();
  }
  /// Get the absolute path to this vault's nickname settings. This is a
  /// hidden file in the root of the vault. Ideally, we would have this file
  /// in the plugin's install folder but it is currently tricky to access
  /// files in other vaults' config folder.
  ///
  getSharedSettingsFilePath() {
    return [
      this.app.vault.adapter.getBasePath(),
      VAULT_LOCAL_SHARED_SETTINGS_FILE_PATH
    ].join(PATH_SEPARATOR);
  }
  // Using synchronous calls because they prevent momentary flicker when
  // vault nicknames are applied.
  filePathExistsSync(absoluteFilePath) {
    return this.app.vault.adapter.fs.existsSync(absoluteFilePath);
  }
  readUtf8FileSync(absoluteFilePath) {
    return this.app.vault.adapter.fs.readFileSync(absoluteFilePath, "utf8");
  }
  writeUtf8FileSync(absoluteFilePath, content) {
    this.app.vault.adapter.fs.writeFileSync(absoluteFilePath, content, "utf8");
  }
};
var VaultNicknameSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.addClass("vault-nickname-settings");
    new import_obsidian.Setting(containerEl).setName("Vault nickname").setDesc("Override the vault's display name.").setTooltip(
      import_obsidian.Platform.isDesktop ? "A vault nickname controls the text shown in the workspace's vault switcher. The 'Manage Vaults' window will continue showing the true vault name as these may be disambiguated by their visible path." : "A vault nickname controls the text shown in the workspace's side panel."
    ).addText((textComponent) => {
      textComponent.setPlaceholder("No nickname").setValue(this.plugin.sharedSettings.nickname).onChange(async (newValue) => {
        this.plugin.sharedSettings.nickname = newValue;
        await this.plugin.saveSettings();
      });
    }).addButton((buttonComponent) => {
      buttonComponent.setIcon("folder-up").setTooltip("Use the name of the vault's parents folder.").onClick(async (mouseEvent) => {
        const parentFolderName = this.plugin.getVaultParentFolderName();
        if (!parentFolderName) {
          return;
        }
        this.plugin.sharedSettings.nickname = parentFolderName;
        this.display();
        await this.plugin.saveSettings();
      });
    });
    if (import_obsidian.Platform.isDesktopApp) {
      new import_obsidian.Setting(containerEl).setName("Nickname in app title").setDesc("Position and use of vault nickname in the app title.").addDropdown((dropdownComponent) => {
        dropdownComponent.addOption("override-app-title:off", "Off");
        dropdownComponent.addOption("override-app-title:vault-first", "Vault name first");
        dropdownComponent.addOption("override-app-title:file-first", "File name first");
        dropdownComponent.setValue(this.plugin.settings.overrideAppTitle);
        dropdownComponent.onChange(async (newValue) => {
          this.plugin.settings.overrideAppTitle = newValue;
          this.plugin.refreshVaultDisplayName();
          await this.plugin.saveSettings();
        });
      });
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtcclxuICAgIEFwcCxcclxuICAgIE1lbnUsXHJcbiAgICBQbGF0Zm9ybSxcclxuICAgIFBsdWdpbixcclxuICAgIFBsdWdpblNldHRpbmdUYWIsXHJcbiAgICBTZXR0aW5nLFxyXG4gICAgVEFic3RyYWN0RmlsZSxcclxuICAgIFdvcmtzcGFjZUxlYWYsXHJcbiAgICBub3JtYWxpemVQYXRoLFxyXG59IGZyb20gXCJvYnNpZGlhblwiO1xyXG5cclxuaW50ZXJmYWNlIFZhdWx0Tmlja25hbWVQbHVnaW5TZXR0aW5ncyB7XHJcbiAgICBvdmVycmlkZUFwcFRpdGxlOiBzdHJpbmc7XHJcbn1cclxuXHJcbmludGVyZmFjZSBWYXVsdE5pY2tuYW1lU2hhcmVkUGx1Z2luU2V0dGluZ3Mge1xyXG4gICAgLy8vIFRoZSBvdmVycmlkZSB2YXVsdCBkaXNwbGF5IG5hbWUuIFVzZWQgaW4gdGhlIHZhdWx0IHN3aXRjaGVyLlxyXG4gICAgLy8vIElmIGVtcHR5IG9yIHdoaXRlc3BhY2UsIHRoZSB2YXVsdCdzIGFjdHVhbCBuYW1lIChmb2xkZXIgbmFtZSkgaXMgdXNlZC5cclxuICAgIC8vL1xyXG4gICAgbmlja25hbWU6IHN0cmluZztcclxufVxyXG5cclxuY29uc3QgREVGQVVMVF9QTFVHSU5fU0VUVElOR1M6IFZhdWx0Tmlja25hbWVQbHVnaW5TZXR0aW5ncyA9IHtcclxuICAgIG92ZXJyaWRlQXBwVGl0bGU6ICdvdmVycmlkZS1hcHAtdGl0bGU6ZmlsZS1maXJzdCcsXHJcbn07XHJcblxyXG5jb25zdCBERUZBVUxUX1NIQVJFRF9TRVRUSU5HUzogVmF1bHROaWNrbmFtZVNoYXJlZFBsdWdpblNldHRpbmdzID0ge1xyXG4gICAgbmlja25hbWU6IFwiTXkgVmF1bHQgTmlja25hbWVcIixcclxufTtcclxuXHJcbmNvbnN0IFBBVEhfU0VQQVJBVE9SOiBzdHJpbmcgPSBQbGF0Zm9ybS5pc1dpbiA/ICdcXFxcJyA6ICcvJztcclxuXHJcbi8vLyBUaGUgdmF1bHQtbG9jYWwgcGF0aCB0byB0aGUgcGx1Z2luJ3Mgc2V0dGluZ3MuIFRoaXMgZmlsZSBpcyBpbnRlbnRpb25hbGx5XHJcbi8vLyBzdG9yZWQgaW4gdGhlIHZhdWx0J3Mgcm9vdCAoYXMgYSBoaWRkZW4gZmlsZSkgdG8gZW5zdXJlIGl0IGNhbiBiZSBmb3VuZCBieVxyXG4vLy8gaW5zdGFuY2VzIG9mIHRoZSBwbHVnaW4gcnVubmluZyBpbiBvdGhlciB2YXVsdHMuXHJcbi8vL1xyXG5jb25zdCBWQVVMVF9MT0NBTF9TSEFSRURfU0VUVElOR1NfRklMRV9QQVRIID0gXCIudmF1bHQtbmlja25hbWVcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZhdWx0Tmlja25hbWVQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG5cclxuICAgIC8vLyBJcyB0aGUgcGx1Z2luIGlzIGVuYWJsZWQuIFVzZWQgYnkgYG9ubG9hZGAgdG8gcmVsaWFibHkgY2hlY2sgdGhlXHJcbiAgICAvLy8gcGx1Z2luJ3Mgc3RhdGUgYXMgYSB3b3JrYXJvdW5kIGZvciBgdGhpcy5hcHAucGx1Z2lucy5lbmFibGVkUGx1Z2luc2BcclxuICAgIC8vLyBvbWl0dGluZyBwbHVnaW5zIHRoYXQgYXJlIGFjdGl2ZWx5IGxvYWRpbmcuXHJcbiAgICAvLy9cclxuICAgIGlzRW5hYmxlZCA9IGZhbHNlO1xyXG5cclxuICAgIHNldHRpbmdzOiBWYXVsdE5pY2tuYW1lUGx1Z2luU2V0dGluZ3M7XHJcblxyXG4gICAgc2hhcmVkU2V0dGluZ3M6IFZhdWx0Tmlja25hbWVTaGFyZWRQbHVnaW5TZXR0aW5ncztcclxuXHJcbiAgICAvLy8gVGhlIHZhdWx0IHN3aXRjaGVyIChkZXNrdG9wLW9ubHkpLiBDYWNoZWQgc28gY2FsbGJhY2tzIGNhbiBjaGVjayBpZlxyXG4gICAgLy8vIGl0J3MgY29udGV4dCBtZW51IGlzIHZpc2libGU6IGBoYXNDbGFzcygnaGFzLWFjdGl2ZSAtIG1lbnUnKWBcclxuICAgIC8vL1xyXG4gICAgZGVza3RvcFZhdWx0U3dpdGNoZXJFbGVtZW50OiBFbGVtZW50IHwgbnVsbDtcclxuXHJcbiAgICAvLy8gQSBjYWxsYmFjayBpbnZva2VkIHdoZW5ldmVyIHRoZSB1c2VyIGNsaWNrcyBhbiBpdGVtIGluIHRoZSBmaWxlIHRyZWUuXHJcbiAgICAvLy8gRW5zdXJlcyB0aGUgYXBwIHRpdGxlIGNvcnJlY3RseSB1cGRhdGVzIHRvIHNob3cgdGhlIHZhdWx0J3Mgbmlja25hbWUuXHJcbiAgICAvLy9cclxuICAgIHZhdWx0SXRlbVJlbmFtZWRDYWxsYmFjazogKF86IFRBYnN0cmFjdEZpbGUgfCBudWxsKSA9PiB2b2lkO1xyXG5cclxuICAgIC8vLyBBIGNhbGxiYWNrIGludm9rZWQgd2hlbmV2ZXIgdGhlIHVzZXIgY2xpY2tzIGFuIGl0ZW0gaW4gdGhlIGZpbGUgdHJlZS5cclxuICAgIC8vLyBFbnN1cmVzIHRoZSBhcHAgdGl0bGUgY29ycmVjdGx5IHVwZGF0ZXMgdG8gc2hvdyB0aGUgdmF1bHQncyBuaWNrbmFtZS5cclxuICAgIC8vL1xyXG4gICAgYWN0aXZlTGVhZkNoYW5nZUNhbGxiYWNrOiAoXzogV29ya3NwYWNlTGVhZiB8IG51bGwpID0+IHZvaWQ7XHJcblxyXG4gICAgYXN5bmMgb25sb2FkKCkge1xyXG4gICAgICAgIHRoaXMuaXNFbmFibGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIGJvdW5kIGNhbGxiYWNrcyBmb3IgYWNjZXNzIHRvIGB0aGlzYCBwb2ludGVyLlxyXG4gICAgICAgIHRoaXMudmF1bHRJdGVtUmVuYW1lZENhbGxiYWNrID0gdGhpcy5vblZhdWx0SXRlbVJlbmFtZWQuYmluZCh0aGlzKTtcclxuICAgICAgICB0aGlzLmFjdGl2ZUxlYWZDaGFuZ2VDYWxsYmFjayA9IHRoaXMub25BY3RpdmVMZWFmQ2hhbmdlLmJpbmQodGhpcyk7XHJcblxyXG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzRmlsZVBhdGggPSB0aGlzLmdldFNoYXJlZFNldHRpbmdzRmlsZVBhdGgoKTtcclxuXHJcbiAgICAgICAgbGV0IHNhdmVTZXR0aW5nc0V4aXN0ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZXhpc3RzKHNldHRpbmdzRmlsZVBhdGgpXHJcbiAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICAgICAgKGV4aXN0cykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVTZXR0aW5nc0V4aXN0ID0gZXhpc3RzO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIChyZWplY3RSZWFzb24pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlU2V0dGluZ3NFeGlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAoIXNhdmVTZXR0aW5nc0V4aXN0KSB7XHJcbiAgICAgICAgICAgIC8vIEVuc3VyZSB0aGUgbmlja25hbWUgZmlsZSBleGlzdHMgc28gb3RoZXIgdmF1bHRzIGNhbiBpbW1lZGlhdGVseVxyXG4gICAgICAgICAgICAvLyBkaXNwbGF5IGl0cyBuaWNrbmFtZS5cclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgVmF1bHROaWNrbmFtZVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcclxuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeSh0aGlzLm9uTGF5b3V0UmVhZHkuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLnZhdWx0Lm9uKCdyZW5hbWUnLCB0aGlzLnZhdWx0SXRlbVJlbmFtZWRDYWxsYmFjaykpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudCh0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2FjdGl2ZS1sZWFmLWNoYW5nZScsIHRoaXMuYWN0aXZlTGVhZkNoYW5nZUNhbGxiYWNrKSk7XHJcbiAgICB9XHJcblxyXG4gICAgb251bmxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5pc0VuYWJsZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy51c2VWYXVsdFN3aXRjaGVyQ2FsbGJhY2tzKGZhbHNlKTtcclxuICAgICAgICB0aGlzLnJlZnJlc2hWYXVsdERpc3BsYXlOYW1lKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRlc2t0b3BWYXVsdFN3aXRjaGVyRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmRlc2t0b3BWYXVsdFN3aXRjaGVyRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy5kZXNrdG9wVmF1bHRTd2l0Y2hlckVsZW1lbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLy8gQ3JlYXRlcyBhbiBpbnZpc2libGUgJ2ludGVyY2VwdG9yJyBlbGVtZW50IG92ZXIgdGhlIHZhdWx0IHN3aXRjaGVyXHJcbiAgICAvLy8gZWxlbWVudC4gVGhpcyBpcyB1c2VkIHRvIGNhdGNoIGNsaWNrIGV2ZW50cyBhbmQgcmVjcmVhdGUgT2JzaWRpYW4nc1xyXG4gICAgLy8vIG5vcm1hbCBtZW51cywgYnV0IGRpc3BsYXlpbmcgdGhlIHZhdWx0IG5pY2tuYW1lcy4gVGhpcyB3YXMgbmVjZXNzYXJ5XHJcbiAgICAvLy8gdG8gbWFrZSB0aGUgcGx1Z2luIHdvcmsgb24gbWFjT1Mgd2hlcmUgdGhlc2UgY29udGV4dCBtZW51cyBhcmUgcmVuZGVyZWRcclxuICAgIC8vLyBuYXRpdmVseSBhbmQgb3RoZXJ3aXNlIGNvdWxkbid0IGJlIG1vZGlmaWVkLlxyXG4gICAgLy8vXHJcbiAgICBvbkxheW91dFJlYWR5KCkge1xyXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsRGVza3RvcFZhdWx0U3dpdGNoZXJFbGVtZW50ID1cclxuICAgICAgICAgICAgd2luZG93LmFjdGl2ZURvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53b3Jrc3BhY2UtZHJhd2VyLXZhdWx0LXN3aXRjaGVyJyk7XHJcblxyXG4gICAgICAgIGlmICghb3JpZ2luYWxEZXNrdG9wVmF1bHRTd2l0Y2hlckVsZW1lbnQpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVmF1bHQgc3dpdGNoZXIgZWxlbWVudCBub3QgZm91bmQuIENhbm5vdCBjcmVhdGUgZWxlbWVudCB0byBpbnRlcmNlcHQgaXRzIGV2ZW50cy4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIE5lY2Vzc2FyeSB0byBtYWtlIHRoZSBpbnRlcmNlcHRvciBlbGVtZW50IGZpdCB0byB0aGUgdmF1bHRcclxuICAgICAgICAgICAgLy8gc3dpdGNoZXIncyBzaXplLlxyXG4gICAgICAgICAgICBvcmlnaW5hbERlc2t0b3BWYXVsdFN3aXRjaGVyRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmRlc2t0b3BWYXVsdFN3aXRjaGVyRWxlbWVudCA9XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbERlc2t0b3BWYXVsdFN3aXRjaGVyRWxlbWVudC5jcmVhdGVEaXYoJy53b3Jrc3BhY2UtZHJhd2VyLXZhdWx0LXN3aXRjaGVyLXZhdWx0LW5pY2tuYW1lLWludGVyY2VwdG9yJyk7XHJcblxyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5kZXNrdG9wVmF1bHRTd2l0Y2hlckVsZW1lbnQuc3R5bGUsXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICAgICAgICAnYWJzb2x1dGUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvcDogICAgICAgICAgICAgJzAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6ICAgICAgICAgICAgJzAnLFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAgICAgICAgICAgJzEwMCUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogICAgICAgICAgJzEwMCUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcclxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAgICAgICAgICdub25lJyxcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZGVza3RvcFZhdWx0U3dpdGNoZXJFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblZhdWx0U3dpdGNoZXJDbGlja2VkLmJpbmQodGhpcykpO1xyXG4gICAgICAgICAgICB0aGlzLmRlc2t0b3BWYXVsdFN3aXRjaGVyRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIHRoaXMub25WYXVsdFN3aXRjaGVyQ29udGV4dE1lbnUuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnVzZVZhdWx0U3dpdGNoZXJDYWxsYmFja3ModHJ1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJlZnJlc2hWYXVsdERpc3BsYXlOYW1lKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdXNlVmF1bHRTd2l0Y2hlckNhbGxiYWNrcyh1c2U6IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAoUGxhdGZvcm0uaXNNb2JpbGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGVza3RvcFZhdWx0U3dpdGNoZXJFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVza3RvcFZhdWx0U3dpdGNoZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSB1c2UgPyAnYmxvY2snIDogJ2hpZGRlbic7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vLyBRdWVyeSBmb3IgYSBzZWxlY3Rvci4gSWYgbm90IGZvdW5kLCB0cnkgb2JzZXJ2aW5nIGZvclxyXG4gICAgLy8vIGB0aW1lb3V0TWlsbGlzZWNvbmRzYCBmb3IgaXQgdG8gYmUgYWRkZWQsIG90aGVyd2lzZSByZXR1cm4gYG51bGxgLlxyXG4gICAgLy8vXHJcbiAgICBhc3luYyB3YWl0Rm9yU2VsZWN0b3Ioc2VhcmNoRnJvbTogRG9jdW1lbnQgfCBFbGVtZW50ICwgc2VsZWN0b3I6IHN0cmluZywgdGltZW91dE1pbGxpc2Vjb25kczogbnVtYmVyKSA6IFByb21pc2U8RWxlbWVudHxudWxsPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPEVsZW1lbnQgfCBudWxsPihyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHNlYXJjaEZyb20ucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgLy8gQWxyZWFkeSBleGlzdHMuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gV2FpdCBmb3IgaXQgYXBwZWFyLlxyXG4gICAgICAgICAgICBjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiByZXNvbHZlKG51bGwpLCB0aW1lb3V0TWlsbGlzZWNvbmRzKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIobXV0YXRpb25zID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBzZWFyY2hGcm9tLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShzZWFyY2hGcm9tLCB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBzdWJ0cmVlOiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vLyBJbnZva2VkIHdoZW4gYSB2YXVsdCBpdGVtIGlzIHJlbmFtZWQuIEFwcGxpZXMgdGhlIHZhdWx0J3Mgbmlja25hbWUgdG9cclxuICAgIC8vLyB0aGUgd2luZG93IHRpdGxlLlxyXG4gICAgLy8vXHJcbiAgICBvblZhdWx0SXRlbVJlbmFtZWQoXzogVEFic3RyYWN0RmlsZSB8IG51bGwpIHtcclxuICAgICAgICB0aGlzLnJlZnJlc2hWYXVsdERpc3BsYXlOYW1lKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8vIEludm9rZWQgd2hlbiB0aGUgYWN0aXZlIHdvcmtzcGFjZSBsZWFmIHdhcyBjaGFuZ2VkLiBBcHBsaWVzIHRoZSB2YXVsdCdzXHJcbiAgICAvLy8gbmlja25hbWUgdG8gdGhlIHdpbmRvdyB0aXRsZS5cclxuICAgIC8vL1xyXG4gICAgb25BY3RpdmVMZWFmQ2hhbmdlKF86IFdvcmtzcGFjZUxlYWYgfCBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5yZWZyZXNoVmF1bHREaXNwbGF5TmFtZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vLyBJbnZva2VkIHdoZW4gdGhlIHVzZXIgY2xpY2tzIHRoZSB3b3Jrc3BhY2UncyB2YXVsdCBzd2l0Y2hlciBkcmF3ZXIuXHJcbiAgICAvLy8gVGhpcyBmdW5jdGlvbiBjaGFuZ2VzIHRoZSB2YXVsdCBuYW1lcyBzaG93biBpbiB0aGUgdmF1bHQgcG9wdXAgbWVudVxyXG4gICAgLy8vIHRvIHRoZSBuYW1lcyBwcm92aWRlZCBieSB0aGUgdmF1bHQncyBwZXJzb25hbCBWYXVsdCBOaWNrbmFtZSBwbHVnaW4uXHJcbiAgICAvLy9cclxuICAgIG9uVmF1bHRTd2l0Y2hlckNsaWNrZWQoZXZlbnQ6IEV2ZW50KSB7XHJcbiAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgIC8vIEFsbG93IGhvbGRpbmcgdGhlIHNoaWZ0IGtleSB0byBjYWxsIHRoZSBvcmlnaW5hbCBiZWhhdmlvci5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgIC8vIFRPRE86IFRoaXMgaXMgYXQgbGVhc3Qgb25lIEFQSSB0aGF0IHByZXZlbnRzIHN1cHBvcnQgb24gbW9iaWxlXHJcbiAgICAgICAgLy8gICAgICAgKHRoYW5rcyBAam9ldGhlaSBmb3IgaWRlbnRpZnlpbmcpLiBOZWVkIHRvIGZpbmQgYVxyXG4gICAgICAgIC8vICAgICAgIG1vYmlsZSAtIGZyaWVuZGx5IGFsdGVybmF0aXZlLlxyXG4gICAgICAgIGNvbnN0IHZhdWx0cyA9IGVsZWN0cm9uLmlwY1JlbmRlcmVyLnNlbmRTeW5jKFwidmF1bHQtbGlzdFwiKTtcclxuXHJcbiAgICAgICAgY29uc3QgbWVudSA9IG5ldyBNZW51KCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHZhdWx0S2V5IGluIHZhdWx0cykge1xyXG4gICAgICAgICAgICBjb25zdCB2YXVsdCA9IHZhdWx0c1t2YXVsdEtleV07XHJcblxyXG4gICAgICAgICAgICBjb25zdCB2YXVsdFBhdGggPSBub3JtYWxpemVQYXRoKHZhdWx0LnBhdGgpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHZhdWx0TmFtZSA9IHZhdWx0UGF0aC5zdWJzdHJpbmcodmF1bHRQYXRoLmxhc3RJbmRleE9mKCcvJykgKyAxKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFdlIGNvdWxkIHVzZSB0aGUgZm9sbG93aW5nIHVuZG9jdW1lbnRlZCBmdW5jdGlvbiBraW5kbHkgc2hhcmVkXHJcbiAgICAgICAgICAgIC8vIGJ5IEBtbmFvdW1vdiAoaHR0cHM6Ly9mb3J1bS5vYnNpZGlhbi5tZC90L3NoYXJpbmctcGx1Z2luLWRhdGEtYmV0d2Vlbi12YXVsdHMtc3R1bXBlZC1ieS1vdmVycmlkZS1jb25maWctZm9sZGVyLzkyNTcwLzIpLFxyXG4gICAgICAgICAgICAvLyB0byBsZWFybiBhIHZhdWx0J3MgY29uZmlnIGZvbGRlci4gSG93ZXZlciwgd2Ugd291bGQgc3RpbGwgbmVlZFxyXG4gICAgICAgICAgICAvLyBhIGZhbGxiYWNrICcub2JzaWRpYW4nIGxpdGVyYWwgdG8gaGFuZGxlIHRoZSBkZWZhdWx0IGNhc2Ugb2YgYVxyXG4gICAgICAgICAgICAvLyB2YXVsdCB1c2luZyB0aGUgbm9ybWFsIGNvbmZpZyBmb2xkZXIgKGJlY2F1c2UgaW4gdGhvc2UgY2FzZXMsXHJcbiAgICAgICAgICAgIC8vIHRoZSBmdW5jdGlvbiByZXR1cm5zIGBudWxsYCkuIEhhdmluZyBhIHN0cmluZyBsaXRlcmFsIGZvciB0aGVcclxuICAgICAgICAgICAgLy8gZGVmYXVsdCBjb25maWcgZm9sZGVyIGNhdXNlcyB0cm91YmxlIHdpdGggT2JzaWRpYW5SZXZpZXdCb3Qgb25cclxuICAgICAgICAgICAgLy8gZ2l0aHViLlxyXG4gICAgICAgICAgICAvL2NvbnN0IHZhdWx0Q29uZmlnRm9sZGVyTmFtZSA9IEFwcC5nZXRPdmVycmlkZUNvbmZpZ0Rpcih2YXVsdEtleSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB2YXVsdFBsdWdpblNldHRpbmdzRmlsZVBhdGggPSBub3JtYWxpemVQYXRoKFtcclxuICAgICAgICAgICAgICAgIHZhdWx0LnBhdGgsXHJcbiAgICAgICAgICAgICAgICBWQVVMVF9MT0NBTF9TSEFSRURfU0VUVElOR1NfRklMRV9QQVRIXHJcbiAgICAgICAgICAgIF0uam9pbihQQVRIX1NFUEFSQVRPUikpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZmlsZVBhdGhFeGlzdHNTeW5jKHZhdWx0UGx1Z2luU2V0dGluZ3NGaWxlUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhdWx0UGx1Z2luU2V0dGluZ3NKc29uID1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlYWRVdGY4RmlsZVN5bmModmF1bHRQbHVnaW5TZXR0aW5nc0ZpbGVQYXRoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodmF1bHRQbHVnaW5TZXR0aW5nc0pzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB2YXVsdFBsdWdpblNldHRpbmdzID0gSlNPTi5wYXJzZSh2YXVsdFBsdWdpblNldHRpbmdzSnNvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YXVsdFBsdWdpblNldHRpbmdzICYmIHZhdWx0UGx1Z2luU2V0dGluZ3Mubmlja25hbWUgJiYgdmF1bHRQbHVnaW5TZXR0aW5ncy5uaWNrbmFtZS50cmltKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmF1bHROYW1lID0gdmF1bHRQbHVnaW5TZXR0aW5ncy5uaWNrbmFtZS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+XHJcbiAgICAgICAgICAgICAgICBpdGVtXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFRpdGxlKHZhdWx0TmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAuc2V0Q2hlY2tlZCh2YXVsdC5wYXRoID09PSB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmJhc2VQYXRoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGBvYnNpZGlhbjovL29wZW4/dmF1bHQ9JHt2YXVsdEtleX1gKVxyXG4gICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1lbnUuYWRkU2VwYXJhdG9yKCk7XHJcblxyXG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT5cclxuICAgICAgICAgICAgaXRlbVxyXG4gICAgICAgICAgICAgICAgLnNldFRpdGxlKHdpbmRvdy5PQlNJRElBTl9ERUZBVUxUX0kxOE4uaW50ZXJmYWNlLm1hbmFnZVZhdWx0cylcclxuICAgICAgICAgICAgICAgIC5zZXRJY29uKCdvcGVuLXZhdWx0JylcclxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmRCeUlkKCdhcHA6b3Blbi12YXVsdCcpXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgbWVudS5zaG93QXRNb3VzZUV2ZW50KGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvLy8gSW52b2tlZCB3aGVuIHRoZSB1c2VyIGNvbnRleHQtY2xpY2tzIG9uIHRoZSB2YXVsdCBzd2l0Y2hlciBkcm9wIGRvd24uXHJcbiAgICAvLy8gQWRkcyBhIFwiU2V0IG5pY2tuYW1lXCIgaXRlbSB0byB0aGUgc3Bhd25lZCBtZW51IGFzIGEgc2hvcnRjdXQgdG8gdGhlXHJcbiAgICAvLy8gcGx1Z2luJ3Mgc2V0dGluZ3MgcGFnZS5cclxuICAgIC8vL1xyXG4gICAgYXN5bmMgb25WYXVsdFN3aXRjaGVyQ29udGV4dE1lbnUoKSB7XHJcbiAgICAgICAgaWYgKFBsYXRmb3JtLmlzTW9iaWxlKSB7XHJcbiAgICAgICAgICAgIC8vIEZlYXR1cmUgZG9lc24ndCBleGlzdCBvbiBtb2JpbGUuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChldmVudC5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICAvLyBBbGxvdyBob2xkaW5nIHRoZSBzaGlmdCBrZXkgdG8gY2FsbCB0aGUgb3JpZ2luYWwgYmVoYXZpb3IuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cclxuICAgICAgICBjb25zdCBtZW51ID0gbmV3IE1lbnUoKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2hvd0luRm9sZGVyVGV4dCA9XHJcbiAgICAgICAgICAgIFBsYXRmb3JtLmlzTWFjT1MgP1xyXG4gICAgICAgICAgICAgICAgd2luZG93Lk9CU0lESUFOX0RFRkFVTFRfSTE4Ti5wbHVnaW5zLm9wZW5XaXRoRGVmYXVsdEFwcC5hY3Rpb25TaG93SW5Gb2xkZXJNYWMgOlxyXG4gICAgICAgICAgICAgICAgd2luZG93Lk9CU0lESUFOX0RFRkFVTFRfSTE4Ti5wbHVnaW5zLm9wZW5XaXRoRGVmYXVsdEFwcC5hY3Rpb25TaG93SW5Gb2xkZXI7XHJcblxyXG4gICAgICAgIG1lbnUuYWRkSXRlbSgoaXRlbSkgPT5cclxuICAgICAgICAgICAgaXRlbVxyXG4gICAgICAgICAgICAgICAgLnNldFRpdGxlKGAke3Nob3dJbkZvbGRlclRleHR9Li4uYClcclxuICAgICAgICAgICAgICAgIC5zZXRJY29uKCdsdWNpZGUtYXJyb3ctdXAtcmlnaHQnKVxyXG4gICAgICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcC5zaG93SW5Gb2xkZXIoXCJcIilcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBtZW51LmFkZFNlcGFyYXRvcigpO1xyXG5cclxuICAgICAgICBtZW51LmFkZEl0ZW0oKGl0ZW0pID0+XHJcbiAgICAgICAgICAgIGl0ZW1cclxuICAgICAgICAgICAgICAgIC5zZXRUaXRsZSgnVmF1bHQgTmlja25hbWUgc2V0dGluZ3MnKVxyXG4gICAgICAgICAgICAgICAgLnNldEljb24oJ3NldHRpbmdzJylcclxuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHRoaXMub3BlblZhdWx0Tmlja25hbWVTZXR0aW5ncygpKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIG1lbnUuc2hvd0F0TW91c2VFdmVudChldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8vIEludm9rZWQgYnkgdGhlIGN1c3RvbSBcIlNldCBuaWNrbmFtZVwiIG1lbnUgaXRlbSBhZGRlZCB0byB0aGUgdmF1bHRcclxuICAgIC8vLyBzd2l0Y2hlcidzIGNvbnRleHQgbWVudS4gT3BlbnMgdGhlIHBsdWdpbnMgc2V0dGluZyBwYWdlIGZvciBxdWlja1xyXG4gICAgLy8vIGFjY2VzcyB0byBuaWNrbmFtZSBmaWVsZC5cclxuICAgIC8vL1xyXG4gICAgYXN5bmMgb3BlblZhdWx0Tmlja25hbWVTZXR0aW5ncygpIHtcclxuICAgICAgICAvLyBPcGVuIHRoZSBzZXR0aW5ncyB3aW5kb3cuXHJcbiAgICAgICAgdGhpcy5hcHAuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmRCeUlkKCdhcHA6b3Blbi1zZXR0aW5ncycpO1xyXG5cclxuICAgICAgICBjb25zdCBzZXR0aW5nc01lbnUgPVxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLndhaXRGb3JTZWxlY3Rvcih3aW5kb3cuYWN0aXZlRG9jdW1lbnQsICcubW9kLXNldHRpbmdzJywgMjAwKTtcclxuXHJcbiAgICAgICAgaWYgKCFzZXR0aW5nc01lbnUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignVGhlIHZhdWx0IHNldHRpbmdzIG1lbnUgd2FzIG5vdCBmb3VuZCBhZnRlciB0aGUgdGltZW91dC4nKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gV2FpdCBmb3IgYW55IHRhYiBpdGVtIHRvIGFwcGVhciB0byBrbm93IHdoZW4gaXQncyBnby10aW1lIHRvIGZpbmRcclxuICAgICAgICAvLyB0YWIgZm9yIHRoaXMgcGx1Z2luLlxyXG4gICAgICAgIGNvbnN0IGFueVRhYiA9XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMud2FpdEZvclNlbGVjdG9yKHdpbmRvdy5hY3RpdmVEb2N1bWVudCwgJy52ZXJ0aWNhbC10YWItbmF2LWl0ZW0nLCAyMDApO1xyXG5cclxuICAgICAgICBpZiAoIWFueVRhYikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUaW1lb3V0IHdoaWxlIHdhaXRpbmcgZm9yIGEgc2V0dGluZ3MgbWVudSB0YWIgdG8gYmUgZm91bmQuJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEZpbmQgdGhlIHRhYiB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoaXMgcGx1Z2luLlxyXG4gICAgICAgIGNvbnN0IHNldHRpbmdzVGFicyA9IHNldHRpbmdzTWVudS5xdWVyeVNlbGVjdG9yQWxsKCcudmVydGljYWwtdGFiLW5hdi1pdGVtJyk7XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgdGFiIG9mIHNldHRpbmdzVGFicykge1xyXG4gICAgICAgICAgICBpZiAodGFiLnRleHRDb250ZW50ICE9PSB0aGlzLm1hbmlmZXN0Lm5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBPcGVuIHRoZSBwbHVnaW4ncyBzZXR0aW5ncyBwYWdlLlxyXG4gICAgICAgICAgICB0YWIuY2xpY2soKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc29sZS5lcnJvcignUGx1Z2luIHRhYiBub3QgZm91bmQuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8vIFJlZnJlc2ggdGhlIHRleHQgZm9yIHRoZSBhY3RpdmUgdmF1bHQgaW4gdGhlIHdvcmtzcGFjZSdzIHZhdWx0IHN3aXRjaGVyXHJcbiAgICAvLy8gZHJhd2VyLiBJZiBubyBuaWNrbmFtZSBleGlzdHMgZm9yIHRoZSBhY3RpdmUgdmF1bHQsIHRoZSBsYWJlbCB3aWxsXHJcbiAgICAvLy8gZmFsbGJhY2sgdG8gdGhlIHZhdWx0J3MgZm9sZGVyIG5hbWUuXHJcbiAgICAvLy9cclxuICAgIHJlZnJlc2hWYXVsdERpc3BsYXlOYW1lKCkge1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRWYXVsdE5hbWUgPVxyXG4gICAgICAgICAgICAodGhpcy5pc0VuYWJsZWQgJiYgdGhpcy5zaGFyZWRTZXR0aW5ncyAmJiB0aGlzLnNoYXJlZFNldHRpbmdzLm5pY2tuYW1lICYmIHRoaXMuc2hhcmVkU2V0dGluZ3Mubmlja25hbWUudHJpbSgpKSA/XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNoYXJlZFNldHRpbmdzLm5pY2tuYW1lLnRyaW0oKSA6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFwcC52YXVsdC5nZXROYW1lKCk7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0VmF1bHREaXNwbGF5TmFtZShjdXJyZW50VmF1bHROYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICAvLy8gQ2hhbmdlIHRoZSBkaXNwbGF5IG5hbWUgb2YgdGhlIGFjdGl2ZSB2YXVsdCBpbiB0aGUgd29ya3NwYWNlJ3MgdmF1bHRcclxuICAgIC8vLyBzd2l0Y2hlciBkcmF3ZXIgYW5kIHRoZSBhcHAgd2luZG93J3MgdGl0bGUuXHJcbiAgICAvLy9cclxuICAgIGFzeW5jIHNldFZhdWx0RGlzcGxheU5hbWUodmF1bHREaXNwbGF5TmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRWYXVsdE5hbWVFbGVtZW50ID0gYXdhaXQgdGhpcy5nZXRWYXVsdFRpdGxlRWxlbWVudCgpO1xyXG5cclxuICAgICAgICBpZiAoIXNlbGVjdGVkVmF1bHROYW1lRWxlbWVudCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdWYXVsdCBuYW1lIGVsZW1lbnQgbm90IGZvdW5kLiBDYW5ub3QgYXBwbHkgbmlja25hbWUuJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzZWxlY3RlZFZhdWx0TmFtZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgc2VsZWN0ZWRWYXVsdE5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gdmF1bHREaXNwbGF5TmFtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2V0QXBwVGl0bGUodmF1bHREaXNwbGF5TmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8vIENoYW5nZSB0aGUgYXBwJ3MgdGl0bGUuIFRoaXMgYXBwbGllcyB0aGUgcHJvdmlkZWQgdmF1bHQgbmFtZSBhbmRcclxuICAgIC8vLyBvcHRpb25hbGx5IHN3aXRjaGVzIHRoZSBvcmRlciBvZiB0aGUgdmF1bHQgYW5kIGRvY3VtZW50IG5hbWVzLlxyXG4gICAgLy8vXHJcbiAgICBzZXRBcHBUaXRsZSh2YXVsdERpc3BsYXlOYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoUGxhdGZvcm0uaXNNb2JpbGVBcHApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3Mub3ZlcnJpZGVBcHBUaXRsZSA9PT0gJ292ZXJyaWRlLWFwcC10aXRsZTpvZmYnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS51cGRhdGVUaXRsZSgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0aXRsZVNlcGFyYXRvciA9ICcgLSAnO1xyXG5cclxuICAgICAgICAvLyBFeHRyYWN0IE9ic2lkaWFuIHZlcnNpb24gZnJvbSB0aXRsZTogXCI8VmF1bHQgTmFtZT4gLSBPYnNpZGlhbiB2LjEuNy43XCJcclxuICAgICAgICBjb25zdCBhcHBUaXRsZSA9IHRoaXMuYXBwLnRpdGxlO1xyXG4gICAgICAgIGlmICghYXBwVGl0bGUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIm5vIHRoaXMuYXBwLnRpdGxlXCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB0aXRsZVBhcnRzID0gYXBwVGl0bGUuc3BsaXQodGl0bGVTZXBhcmF0b3IpO1xyXG4gICAgICAgIGlmICghdGl0bGVQYXJ0cyB8fCB0aXRsZVBhcnRzLmxlbmd0aCA8IDIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcInVuZXhwZWN0ZWQgdGl0bGUgZm9ybWF0OiBcIiArIGFwcFRpdGxlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb2JzaWRpYW5WZXJzaW9uID0gdGl0bGVQYXJ0c1t0aXRsZVBhcnRzLmxlbmd0aCAtIDFdO1xyXG5cclxuICAgICAgICAvLyBHZXQgdGhlIGRvY3VtZW50IHRpdGxlXHJcbiAgICAgICAgY29uc3QgZG9jdW1lbnRUaXRsZSA9ICgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUVkaXRvciA9IHRoaXMuYXBwLndvcmtzcGFjZS5hY3RpdmVFZGl0b3I7XHJcbiAgICAgICAgICAgIGlmIChhY3RpdmVFZGl0b3IgJiYgYWN0aXZlRWRpdG9yLnRpdGxlRWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhY3RpdmVFZGl0b3IudGl0bGVFbC50ZXh0Q29udGVudDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSGFkIHRyaWVkIGdyYWJiaW5nIHRoaXMgZnJvbSBcIi53b3Jrc3BhY2UtbGVhZi5tb2QtYWN0aXZlXCInc1xyXG4gICAgICAgICAgICAvLyBcIi52aWV3LWhlYWRlci10aXRsZVwiIGZvciBtb3JlIHJvYnVzIGxvY2FsaXphdGlvbiBzdXBwb3J0LCBidXRcclxuICAgICAgICAgICAgLy8gZW5jb3VudGVyZWQgdGltaW5nIGlzc3Vlcy5cclxuICAgICAgICAgICAgcmV0dXJuICdOZXcgdGFiJztcclxuICAgICAgICB9KSgpO1xyXG5cclxuICAgICAgICAvLyBBcHBseSB0aGUgdGl0bGVcclxuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5vdmVycmlkZUFwcFRpdGxlID09PSAnb3ZlcnJpZGUtYXBwLXRpdGxlOnZhdWx0LWZpcnN0Jykge1xyXG4gICAgICAgICAgICB3aW5kb3cuYWN0aXZlRG9jdW1lbnQudGl0bGUgPSBbXHJcbiAgICAgICAgICAgICAgICB2YXVsdERpc3BsYXlOYW1lLFxyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRUaXRsZSxcclxuICAgICAgICAgICAgICAgIG9ic2lkaWFuVmVyc2lvblxyXG4gICAgICAgICAgICBdLmpvaW4odGl0bGVTZXBhcmF0b3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgd2luZG93LmFjdGl2ZURvY3VtZW50LnRpdGxlID0gW1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRUaXRsZSxcclxuICAgICAgICAgICAgICAgIHZhdWx0RGlzcGxheU5hbWUsXHJcbiAgICAgICAgICAgICAgICBvYnNpZGlhblZlcnNpb25cclxuICAgICAgICAgICAgXS5qb2luKHRpdGxlU2VwYXJhdG9yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8vIExvYWQgdGhlIHZhdWx0J3Mgbmlja25hbWUuIEN1cnJlbnRseSwgYSBoaWRkZW4gZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGVcclxuICAgIC8vLyB2YXVsdCBpcyB1c2VkIGJlY2F1c2UgaXQgc2ltcGxpZmllcyBzaGFyaW5nIHZhdWx0IG5pY2tuYW1lcyBiZXR3ZWVuXHJcbiAgICAvLy8gb3RoZXIgaW5zdGFuY2VzIG9mIHRoZSBwbHVnaW4uXHJcbiAgICAvLy9cclxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcclxuICAgICAgICAvLyBEZWZhdWx0IHRoZSBuaWNrbmFtZSB0byB0aGUgcGFyZW50IGZvbGRlcidzIG5hbWUuXHJcbiAgICAgICAgY29uc3QgbG9hZGVkU2hhcmVkU2V0dGluZ3M6IFZhdWx0Tmlja25hbWVTaGFyZWRQbHVnaW5TZXR0aW5ncyA9XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0hBUkVEX1NFVFRJTkdTKTtcclxuXHJcbiAgICAgICAgY29uc3QgcGFyZW50Rm9sZGVyTmFtZSA9IHRoaXMuZ2V0VmF1bHRQYXJlbnRGb2xkZXJOYW1lKCk7XHJcbiAgICAgICAgaWYgKHBhcmVudEZvbGRlck5hbWUpIHtcclxuICAgICAgICAgICAgbG9hZGVkU2hhcmVkU2V0dGluZ3Mubmlja25hbWUgPSBwYXJlbnRGb2xkZXJOYW1lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gT3ZlcndyaXRlIGRlZmF1bHQgbmlja25hbWUgd2l0aCBwcmV2aW91c2x5IHNhdmVkIHZhbHVlLlxyXG4gICAgICAgIGNvbnN0IHNoYXJlZFNldHRpbmdzRmlsZVBhdGggPSB0aGlzLmdldFNoYXJlZFNldHRpbmdzRmlsZVBhdGgoKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZmlsZVBhdGhFeGlzdHNTeW5jKHNoYXJlZFNldHRpbmdzRmlsZVBhdGgpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzSnNvbiA9IHRoaXMucmVhZFV0ZjhGaWxlU3luYyhzaGFyZWRTZXR0aW5nc0ZpbGVQYXRoKTtcclxuXHJcbiAgICAgICAgICAgIGxvYWRlZFNoYXJlZFNldHRpbmdzXHJcbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGxvYWRlZFNoYXJlZFNldHRpbmdzLCBKU09OLnBhcnNlKHNldHRpbmdzSnNvbikpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQXBwbHkgdGhlIGxvYWRlZCBuaWNrbmFtZSBzZXR0aW5ncy5cclxuICAgICAgICB0aGlzLnNoYXJlZFNldHRpbmdzID0gbG9hZGVkU2hhcmVkU2V0dGluZ3M7XHJcblxyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1BMVUdJTl9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcclxuXHJcbiAgICAgICAgdGhpcy5yZWZyZXNoVmF1bHREaXNwbGF5TmFtZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vLyBXcml0ZSB0aGUgdmF1bHQncyBuaWNrbmFtZSB0byBkaXNrLiBDdXJyZW50bHksIGEgaGlkZGVuIGZpbGUgaW4gdGhlXHJcbiAgICAvLy8gcm9vdCBvZiB0aGUgdmF1bHQgaXMgdXNlZCBiZWNhdXNlIGl0IHNpbXBsaWZpZXMgc2hhcmluZyB2YXVsdCBuaWNrbmFtZXNcclxuICAgIC8vLyBiZXR3ZWVuIG90aGVyIGluc3RhbmNlcyBvZiB0aGUgcGx1Z2luLlxyXG4gICAgLy8vXHJcbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XHJcbiAgICAgICAgY29uc3Qgc2hhcmVkU2V0dGluZ3NGaWxlUGF0aCA9IHRoaXMuZ2V0U2hhcmVkU2V0dGluZ3NGaWxlUGF0aCgpO1xyXG5cclxuICAgICAgICBpZiAoc2hhcmVkU2V0dGluZ3NGaWxlUGF0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBzaGFyZWRTZXR0aW5nc0pzb24gPSBKU09OLnN0cmluZ2lmeSh0aGlzLnNoYXJlZFNldHRpbmdzLCBudWxsLCAyKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMud3JpdGVVdGY4RmlsZVN5bmMoc2hhcmVkU2V0dGluZ3NGaWxlUGF0aCwgc2hhcmVkU2V0dGluZ3NKc29uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XHJcblxyXG4gICAgICAgIHRoaXMucmVmcmVzaFZhdWx0RGlzcGxheU5hbWUoKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBnZXRWYXVsdFRpdGxlRWxlbWVudCgpOiBQcm9taXNlPEVsZW1lbnQgfCBudWxsPiB7XHJcbiAgICAgICAgLy8gQSB0aW1lb3V0IGlzIG5lY2Vzc2FyeSB0byByZWxpYWJseSBncmFiIHRoZSB0aXRsZSBvbiBtb2JpbGUgc3RhcnR1cC5cclxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy53YWl0Rm9yU2VsZWN0b3IoXHJcbiAgICAgICAgICAgIHdpbmRvdy5hY3RpdmVEb2N1bWVudCxcclxuICAgICAgICAgICAgUGxhdGZvcm0uaXNEZXNrdG9wID8gJy53b3Jrc3BhY2UtZHJhd2VyLXZhdWx0LW5hbWUnIDogJy53b3Jrc3BhY2UtZHJhd2VyLWhlYWRlci1uYW1lLXRleHQnLFxyXG4gICAgICAgICAgICAyMDBcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vLyBHZXQgdGhlIG5hbWUgb2YgdGhlIHZhdWx0J3MgcGFyZW50IGZvbGRlci4gVGhpcyBpcyB1c2VkIGFzIHRoZSBwbHVnaW4nc1xyXG4gICAgLy8vIGRlZmF1bHQgdmF1bHQgbmlja25hbWVcclxuICAgIC8vL1xyXG4gICAgZ2V0VmF1bHRQYXJlbnRGb2xkZXJOYW1lKCk6IHN0cmluZyB7XHJcbiAgICAgICAgLy8gR2V0IHRoZSBhYnNvbHV0ZSBwYXRoIHRvIHRoZSB2YXVsdCdzIHJvb3QuXHJcbiAgICAgICAgY29uc3QgdmF1bHRBYnNvbHV0ZUZpbGVQYXRoID0gdGhpcy5hcHAudmF1bHQuYWRhcHRlci5nZXRCYXNlUGF0aCgpXHJcblxyXG4gICAgICAgIGlmICghdmF1bHRBYnNvbHV0ZUZpbGVQYXRoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRXhwbG9kZSB0aGUgdmF1bHQgcGF0aCBpbnRvIGVhY2ggb2YgaXRzIGZvbGRlcnMuXHJcbiAgICAgICAgY29uc3QgZXhwbG9kZWRWYXVsdFBhdGggPSB2YXVsdEFic29sdXRlRmlsZVBhdGguc3BsaXQoUEFUSF9TRVBBUkFUT1IpO1xyXG4gICAgICAgIGNvbnN0IGluZGV4T2ZQYXJlbnRGb2xkZXIgPSBleHBsb2RlZFZhdWx0UGF0aC5sZW5ndGggLSAyO1xyXG4gICAgICAgIGlmIChpbmRleE9mUGFyZW50Rm9sZGVyIDwgMCB8fCAhZXhwbG9kZWRWYXVsdFBhdGhbaW5kZXhPZlBhcmVudEZvbGRlcl0gfHwgIWV4cGxvZGVkVmF1bHRQYXRoW2luZGV4T2ZQYXJlbnRGb2xkZXJdLnRyaW0oKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBleHBsb2RlZFZhdWx0UGF0aFtpbmRleE9mUGFyZW50Rm9sZGVyXS50cmltKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8vIEdldCB0aGUgYWJzb2x1dGUgcGF0aCB0byB0aGlzIHZhdWx0J3Mgbmlja25hbWUgc2V0dGluZ3MuIFRoaXMgaXMgYVxyXG4gICAgLy8vIGhpZGRlbiBmaWxlIGluIHRoZSByb290IG9mIHRoZSB2YXVsdC4gSWRlYWxseSwgd2Ugd291bGQgaGF2ZSB0aGlzIGZpbGVcclxuICAgIC8vLyBpbiB0aGUgcGx1Z2luJ3MgaW5zdGFsbCBmb2xkZXIgYnV0IGl0IGlzIGN1cnJlbnRseSB0cmlja3kgdG8gYWNjZXNzXHJcbiAgICAvLy8gZmlsZXMgaW4gb3RoZXIgdmF1bHRzJyBjb25maWcgZm9sZGVyLlxyXG4gICAgLy8vXHJcbiAgICBnZXRTaGFyZWRTZXR0aW5nc0ZpbGVQYXRoKCk6IHN0cmluZyB7XHJcbiAgICAgICAgLy8gSWRlYWxseSB3ZSB3b3VsZCB1c2UgYSBWYXVsdCBBUEkgdG8gZ2V0IHRoZSBURmlsZSBvZiB0aGUgc2V0dGluZ3NcclxuICAgICAgICAvLyBmaWxlLiBIb3dldmVyLCB0aGF0IEFQSSBkb2VzIG5vdCBzdXBwb3J0IGhpZGRlbiBmaWxlcy5cclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmdldEJhc2VQYXRoKCksXHJcbiAgICAgICAgICAgIFZBVUxUX0xPQ0FMX1NIQVJFRF9TRVRUSU5HU19GSUxFX1BBVEhcclxuICAgICAgICBdLmpvaW4oUEFUSF9TRVBBUkFUT1IpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzaW5nIHN5bmNocm9ub3VzIGNhbGxzIGJlY2F1c2UgdGhleSBwcmV2ZW50IG1vbWVudGFyeSBmbGlja2VyIHdoZW5cclxuICAgIC8vIHZhdWx0IG5pY2tuYW1lcyBhcmUgYXBwbGllZC5cclxuXHJcbiAgICBmaWxlUGF0aEV4aXN0c1N5bmMoYWJzb2x1dGVGaWxlUGF0aCA6IHN0cmluZykgOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hcHAudmF1bHQuYWRhcHRlci5mcy5leGlzdHNTeW5jKGFic29sdXRlRmlsZVBhdGgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRVdGY4RmlsZVN5bmMoYWJzb2x1dGVGaWxlUGF0aDogc3RyaW5nKSA6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZnMucmVhZEZpbGVTeW5jKGFic29sdXRlRmlsZVBhdGgsICd1dGY4Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgd3JpdGVVdGY4RmlsZVN5bmMoYWJzb2x1dGVGaWxlUGF0aDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmZzLndyaXRlRmlsZVN5bmMoYWJzb2x1dGVGaWxlUGF0aCwgY29udGVudCwgJ3V0ZjgnKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgVmF1bHROaWNrbmFtZVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICAgIHBsdWdpbjogVmF1bHROaWNrbmFtZVBsdWdpbjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBWYXVsdE5pY2tuYW1lUGx1Z2luKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG4gICAgfVxyXG5cclxuICAgIGRpc3BsYXkoKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuXHJcbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcclxuICAgICAgICBjb250YWluZXJFbC5hZGRDbGFzcygndmF1bHQtbmlja25hbWUtc2V0dGluZ3MnKTtcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKCdWYXVsdCBuaWNrbmFtZScpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKCdPdmVycmlkZSB0aGUgdmF1bHRcXCdzIGRpc3BsYXkgbmFtZS4nKVxyXG4gICAgICAgICAgICAuc2V0VG9vbHRpcChcclxuICAgICAgICAgICAgICAgIFBsYXRmb3JtLmlzRGVza3RvcCA/XHJcbiAgICAgICAgICAgICAgICAgICAgXCJBIHZhdWx0IG5pY2tuYW1lIGNvbnRyb2xzIHRoZSB0ZXh0IHNob3duIGluIHRoZSB3b3Jrc3BhY2UncyB2YXVsdCBzd2l0Y2hlci4gVGhlICdNYW5hZ2UgVmF1bHRzJyB3aW5kb3cgd2lsbCBjb250aW51ZSBzaG93aW5nIHRoZSB0cnVlIHZhdWx0IG5hbWUgYXMgdGhlc2UgbWF5IGJlIGRpc2FtYmlndWF0ZWQgYnkgdGhlaXIgdmlzaWJsZSBwYXRoLlwiIDpcclxuICAgICAgICAgICAgICAgICAgICBcIkEgdmF1bHQgbmlja25hbWUgY29udHJvbHMgdGhlIHRleHQgc2hvd24gaW4gdGhlIHdvcmtzcGFjZSdzIHNpZGUgcGFuZWwuXCJcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dENvbXBvbmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gQSB0ZXh0IGZpZWxkIHRvIGFzc2lnbiB0aGUgdmF1bHQncyBuaWNrbmFtZS5cclxuICAgICAgICAgICAgICAgIHRleHRDb21wb25lbnRcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ05vIG5pY2tuYW1lJylcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2hhcmVkU2V0dGluZ3Mubmlja25hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jIG5ld1ZhbHVlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2hhcmVkU2V0dGluZ3Mubmlja25hbWUgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5hZGRCdXR0b24oYnV0dG9uQ29tcG9uZW50ID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIEEgYnV0dG9uIHRvIHF1aWNrbHkgYXBwbHkgdGhlIHZhdWx0J3MgcGFyZW50IGZvbGRlciBuYW1lIGFzXHJcbiAgICAgICAgICAgICAgICAvLyB0aGUgbmlja25hbWUgKGEgY29tbW9uIHVzZSBjYXNlIGFuZCBob3cgdGhlIGRlZmF1bHQgbmlja25hbWVcclxuICAgICAgICAgICAgICAgIC8vIGlzIGNob3NlbikuXHJcbiAgICAgICAgICAgICAgICBidXR0b25Db21wb25lbnRcclxuICAgICAgICAgICAgICAgICAgICAuc2V0SWNvbignZm9sZGVyLXVwJylcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VG9vbHRpcCgnVXNlIHRoZSBuYW1lIG9mIHRoZSB2YXVsdFxcJ3MgcGFyZW50cyBmb2xkZXIuJylcclxuICAgICAgICAgICAgICAgICAgICAub25DbGljayhhc3luYyBtb3VzZUV2ZW50ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50Rm9sZGVyTmFtZSA9IHRoaXMucGx1Z2luLmdldFZhdWx0UGFyZW50Rm9sZGVyTmFtZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcmVudEZvbGRlck5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2hhcmVkU2V0dGluZ3Mubmlja25hbWUgPSBwYXJlbnRGb2xkZXJOYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVmcmVzaCB0aGUgbmlja25hbWUgZmllbGQgaW4gdGhlIHNldHRpbmdzIHdpbmRvdy5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChQbGF0Zm9ybS5pc0Rlc2t0b3BBcHApIHtcclxuICAgICAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgICAgICAuc2V0TmFtZSgnTmlja25hbWUgaW4gYXBwIHRpdGxlJylcclxuICAgICAgICAgICAgICAgIC5zZXREZXNjKCdQb3NpdGlvbiBhbmQgdXNlIG9mIHZhdWx0IG5pY2tuYW1lIGluIHRoZSBhcHAgdGl0bGUuJylcclxuICAgICAgICAgICAgICAgIC5hZGREcm9wZG93bihkcm9wZG93bkNvbXBvbmVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJvcGRvd25Db21wb25lbnQuYWRkT3B0aW9uKCdvdmVycmlkZS1hcHAtdGl0bGU6b2ZmJywgJ09mZicpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duQ29tcG9uZW50LmFkZE9wdGlvbignb3ZlcnJpZGUtYXBwLXRpdGxlOnZhdWx0LWZpcnN0JywgJ1ZhdWx0IG5hbWUgZmlyc3QnKTtcclxuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bkNvbXBvbmVudC5hZGRPcHRpb24oJ292ZXJyaWRlLWFwcC10aXRsZTpmaWxlLWZpcnN0JywgJ0ZpbGUgbmFtZSBmaXJzdCcpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bkNvbXBvbmVudC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5vdmVycmlkZUFwcFRpdGxlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZHJvcGRvd25Db21wb25lbnQub25DaGFuZ2UoYXN5bmMgbmV3VmFsdWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vdmVycmlkZUFwcFRpdGxlID0gbmV3VmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5yZWZyZXNoVmF1bHREaXNwbGF5TmFtZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFVTztBQWFQLElBQU0sMEJBQXVEO0FBQUEsRUFDekQsa0JBQWtCO0FBQ3RCO0FBRUEsSUFBTSwwQkFBNkQ7QUFBQSxFQUMvRCxVQUFVO0FBQ2Q7QUFFQSxJQUFNLGlCQUF5Qix5QkFBUyxRQUFRLE9BQU87QUFNdkQsSUFBTSx3Q0FBd0M7QUFFOUMsSUFBcUIsc0JBQXJCLGNBQWlELHVCQUFP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
